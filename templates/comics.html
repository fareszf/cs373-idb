{% extends "base.html" %}
{% block head %}
{{ super() }}
{% endblock %}


{% block body %}
<!-- <img src="../static/img/loading.gif"> -->
<div class="fullscreen-bg-bills">
    <!-- <img src="../static/img/loading.gif"> -->
    <!-- <img src="static/img/senate.jpg"/> -->
</div>
<h1 align="center">Bills</h1>



<div id="comics">

</div>

<script type="text/babel">
var Table = React.createClass({
    getInitialState: function(){
        return {
            data: []
        }
    },
    // loadData: function(){
    //     $.get(this.props.source, function(result) {
    //       if (this.isMounted()) {
    //         this.setState({
    //           data : []
    //         });
    //       }
    //     }.bind(this));
    // },
    // componentWillMount: function(){
    //     this.loadData();
    // }, 
    componentDidMount: function() {
        var self = this;

        var comparator = function(a, b) {
            a = a["name"];
            b = b["name"];
            if (a < b) {
                return -1;
            } else if (a > b){
               return  1;
            }
            return 0;
        }

        $.get(this.props.source, function(result) {
          var lastGist = result["legislators"].map(function(current) {
            return {
                "name": current["first_name"] + " " + current["last_name"],
                "birthday": current["birthday"].substring(0, 4)
            }
        }).sort(comparator);

          if (this.isMounted()) {
            this.setState({
              data: lastGist
            });
          }
        }.bind(this));
    },
    componentDidUpdate: function(){
        $('#mytable').dataTable({
          "bAutoWidth": false,
          "bDestroy": true, 
        });
    },
    render: function(){ 
        var select_onclick = function() {
            var dob = Math.floor($("#dropdown").val());
            alert(dob);
        }

        var imageStyle = {
            margin: 'auto',
            display: 'block'
        }

        var dropdown = this.state.data.map(function(d, index) {
            return (
                <option value={d["birthday"]}>{d["name"]}</option>
            )
        });

        if(this.state.data.length > 1) {      
            return (
                <div className="container">
                    <select id="dropdown">
                      {dropdown}
                    </select>
                    <button onClick={select_onclick}>Select</button>
                </div>
            )    
        } else {
            return (
                <img src="../static/img/loadingBill.gif" style={imageStyle}/>
            )    
        }
    }
 });
React.render(
    <Table source="http://politicianhub.me/api/v1/legislators" />,
    document.getElementById('comics')
);


</script>
{% endblock %}

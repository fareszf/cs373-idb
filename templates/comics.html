{% extends "base.html" %}
{% block head %}
{{ super() }}
{% endblock %}


{% block body %}
<div class="fullscreen-bg-bills"></div>
<h1 align="center">Bills</h1>

<div id="comics"></div>

<script type="text/babel">
var Table = React.createClass({
    getInitialState: function(){
        return {
            data: [],
            series: []
        }
    },
    componentDidMount: function() {
        var self = this;

        var comparator = function(a, b) {
            a = a["name"];
            b = b["name"];
            if (a < b) {
                return -1;
            } else if (a > b){
               return  1;
            }
            return 0;
        }

        $.get(this.props.source, function(result) {
          var lastGist = result["legislators"].map(function(current) {
            return {
                "name": current["first_name"] + " " + current["last_name"],
                "birthday": current["birthday"].substring(0, 4)
            }
          }).sort(comparator);

          if (this.isMounted()) {
            this.setState({
              data: lastGist
            });
          }
        }.bind(this));

        console.log(this.props.series);

        $.get(this.props.series, function(result) {
			result = result.sort(comparator);
			if (this.isMounted()) {
				this.setState({
					series: result
				});
			}
        }.bind(this));
        
        
    },
    componentDidUpdate: function(){
        $('#mytable').dataTable({
          "bAutoWidth": false,
          "bDestroy": true, 
        });
    },
    render: function(){ 
        var select_onclick = function() {
            var dob = Math.floor($("#dropdown").val());
            alert(dob);
        }

        var imageStyle = {
            margin: 'auto',
            display: 'block'
        }

        var dropdown = this.state.data.map(function(d, index) {
            return (
                <option value={d["birthday"]}>{d["name"]}</option>
            )
        });

        var other_dropdown = this.state.series.map(function(d, index) {
            return (
                <option value={d["startYear"]}>{d["title"]}</option>
            )
        });
        if(this.state.data.length > 1) {      
            return (
                <div className="container">
                    <select id="dropdown">
                      {dropdown}
                    </select>
                    <button onClick={select_onclick}>Select</button>
                    <select>
                      {other_dropdown}
                    </select>
                </div>
            )    
        } else {
            return (
                <img src="../static/img/loadingBill.gif" style={imageStyle}/>
            )    
        }
    }
 });
React.render(
    <Table
        source="http://politicianhub.me/api/v1/legislators"
        series="http://politicianhub.me/marvel" />,
    document.getElementById('comics')
);


</script>
{% endblock %}
